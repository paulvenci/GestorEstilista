import{_ as V,a as k}from"./3c6CXcVn.js";import{_ as C}from"./BZfyVz6G.js";import{e as U,f as B,g as N,o as f,c as g,a as d,b as n,w as v,i as x,h as t,j as S,t as w,k as E,l as I,r as m,m as R,n as b}from"./BKcyA04J.js";import"./DlAUqK2U.js";import"./D699539O.js";import"./B6A3F-fM.js";const M={class:"space-y-6"},P={key:0,class:"p-3 bg-red-100 dark:bg-red-900/30 text-red-600 dark:text-red-400 text-sm rounded-lg mb-4 text-center"},T={class:"mt-4 text-center text-xs text-gray-400 space-y-1"},j={class:"text-xs text-slate-300 dark:text-slate-600"},z=U({__name:"login",setup(q){const _=B();N();const h=I(),l=m(""),r=m(""),p=m(!1),i=m(""),y=async()=>{p.value=!0,i.value="";try{const{error:a}=await _.auth.signInWithPassword({email:l.value,password:r.value});if(a)throw a;const e=R();let o=0;for(;!e.value&&o<10;)await new Promise(s=>setTimeout(s,200)),o++;if(!e.value){window.location.href="/login";return}const{data:u}=await _.from("profiles").select("tenants ( slug )").eq("id",e.value.id).single(),c=u?.tenants?.slug||"";c?b(`/${c}/agenda`):b("/admin")}catch(a){i.value=a.message||"Error al iniciar sesión"}finally{p.value=!1}};return(a,e)=>{const o=V,u=k,c=C;return f(),g("div",M,[d("form",{onSubmit:S(y,["prevent"]),class:"space-y-6"},[n(u,{label:"Correo Electrónico",name:"email"},{default:v(()=>[n(o,{modelValue:t(l),"onUpdate:modelValue":e[0]||(e[0]=s=>x(l)?l.value=s:null),type:"email",placeholder:"tu@email.com",icon:"i-heroicons-envelope"},null,8,["modelValue"])]),_:1}),n(u,{label:"Contraseña",name:"password"},{default:v(()=>[n(o,{modelValue:t(r),"onUpdate:modelValue":e[1]||(e[1]=s=>x(r)?r.value=s:null),type:"password",placeholder:"********",icon:"i-heroicons-lock-closed"},null,8,["modelValue"])]),_:1}),n(c,{type:"submit",block:"",loading:t(p),label:"Ingresar"},null,8,["loading"])],32),t(i)?(f(),g("div",P,w(t(i)),1)):E("",!0),d("div",T,[e[2]||(e[2]=d("p",null,"¿No tienes cuenta? Contacta a tu administrador.",-1)),d("p",j,"v"+w(t(h).public.appVersion),1)])])}}});export{z as default};
