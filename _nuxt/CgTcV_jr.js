import{f as C,_ as E}from"./D8U0mdRn.js";import{_ as j}from"./Cs5bkChp.js";import{_ as S,b as D}from"./WxzpVJyX.js";import{_ as M,u as d}from"./DwJUnjbP.js";import{_ as P}from"./D1QdOcyS.js";import{_ as T}from"./BdyN-ehQ.js";import{k as W,U as G,l as I,c as N,a as n,b as o,w as l,r as f,o as B,W as H,e as s,t as q,d as h,i as z}from"./B5RJlC2E.js";import"./QjCVFdca.js";import"./DlAUqK2U.js";import"./D2RKDNJX.js";import"./B7BlbZFb.js";import"./k50w4hI7.js";import"./D7pqAUps.js";import"./DEWpC0RW.js";const F={class:"p-4 max-w-4xl mx-auto items-start gap-6"},R={class:"font-semibold text-lg flex items-center gap-2"},$={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},J={class:"bg-gray-50 dark:bg-slate-800 p-4 rounded-lg text-sm"},L={class:"p-3 bg-white dark:bg-slate-900 border rounded border-gray-200 dark:border-slate-700 italic text-gray-600 dark:text-gray-400"},K={class:"flex justify-between items-center bg-gray-50 dark:bg-slate-800/50 p-4 rounded-xl border border-gray-100 dark:border-slate-700/50"},O={class:"flex items-center gap-2"},pe=W({__name:"settings",setup(Q){const p=G(),u=f(!1),_=f(!1),a=f({whatsapp_template:"",enable_reminders:!1,reminder_hours_before:24,whatsapp_phone_number_id:"",whatsapp_access_token:""}),m={cliente:"Juan Pérez",fecha:new Date().toLocaleDateString("es-ES",{weekday:"long",day:"numeric",month:"long"}),hora:"14:30",estilista:"Ana Gómez"},v=z(()=>{let t=a.value.whatsapp_template||"Hola {cliente}, recordamos tu cita en GestorEstilista el {fecha} a las {hora}.";return t=t.replace(/{cliente}/g,m.cliente),t=t.replace(/{fecha}/g,m.fecha),t=t.replace(/{hora}/g,m.hora),t=t.replace(/{estilista}/g,m.estilista),t}),w=async()=>{try{const{data:{user:t}}=await p.auth.getUser();if(!t)return;const{data:e,error:i}=await p.from("tenants").select("settings").single();if(i){console.error("Error fetching settings:",i);return}e&&e.settings&&(a.value={...a.value,...e.settings})}catch(t){console.error(t)}},y=async()=>{u.value=!0;try{const{error:t}=await p.rpc("update_tenant_settings",{p_settings:a.value});if(t)throw t;d().add({title:"Configuración guardada",icon:"i-heroicons-check-circle",color:"green"})}catch(t){d().add({title:"Error al guardar",description:t.message,icon:"i-heroicons-x-circle",color:"red"})}finally{u.value=!1}},k=async()=>{if(!a.value.whatsapp_phone_number_id||!a.value.whatsapp_access_token)return d().add({title:"Faltan credenciales",color:"red"});const t=prompt("Ingresa un número de celular para la prueba (con código de país, ej: 56912345678):");if(t){_.value=!0;try{const{data:e,error:i}=await p.functions.invoke("send-reminders",{body:{action:"test",to:t,test_settings:a.value}});if(i)throw i;d().add({title:"Mensaje enviado",description:"Revisa tu WhatsApp",color:"green"})}catch(e){d().add({title:"Error en la prueba",description:e.message,color:"red"})}finally{_.value=!1}}};return I(()=>{w()}),(t,e)=>{const i=E,V=j,c=S,b=M,U=P,g=D,x=C,A=T;return B(),N("div",F,[e[10]||(e[10]=n("div",{class:"mb-6"},[n("h1",{class:"text-2xl font-bold text-gray-900 dark:text-white"},"Configuración"),n("p",{class:"text-gray-500 dark:text-gray-400"},"Administra las preferencias de tu negocio.")],-1)),o(A,null,{header:l(()=>[n("h2",R,[o(i,{name:"i-heroicons-chat-bubble-left-right",class:"text-green-500"}),e[5]||(e[5]=h(" Notificaciones WhatsApp ",-1))])]),default:l(()=>[n("form",{onSubmit:H(y,["prevent"]),class:"space-y-6"},[o(c,{label:"Plantilla de Mensaje (Citas)",help:"Variables: {cliente}, {fecha}, {hora}, {estilista}"},{default:l(()=>[o(V,{modelValue:s(a).whatsapp_template,"onUpdate:modelValue":e[0]||(e[0]=r=>s(a).whatsapp_template=r),rows:4,placeholder:"Hola {cliente}, te recordamos tu cita el {fecha} a las {hora} con {estilista}."},null,8,["modelValue"])]),_:1}),o(b),n("div",$,[o(c,{label:"Habilitar Recordatorios Automáticos",help:"Enviar mensajes automáticamente a los clientes"},{default:l(()=>[o(U,{modelValue:s(a).enable_reminders,"onUpdate:modelValue":e[1]||(e[1]=r=>s(a).enable_reminders=r)},null,8,["modelValue"])]),_:1}),o(c,{label:"Anticipación (Horas)",help:"Cuántas horas antes de la cita enviar el mensaje"},{default:l(()=>[o(g,{modelValue:s(a).reminder_hours_before,"onUpdate:modelValue":e[2]||(e[2]=r=>s(a).reminder_hours_before=r),type:"number",min:"1",max:"72",placeholder:"24",icon:"i-heroicons-clock"},null,8,["modelValue"])]),_:1}),o(c,{label:"WhatsApp Phone Number ID",help:"ID del número de teléfono en Meta for Developers"},{default:l(()=>[o(g,{modelValue:s(a).whatsapp_phone_number_id,"onUpdate:modelValue":e[3]||(e[3]=r=>s(a).whatsapp_phone_number_id=r),icon:"i-heroicons-hashtag",placeholder:"Ej: 100609346..."},null,8,["modelValue"])]),_:1}),o(c,{label:"WhatsApp Access Token",help:"Token de acceso (Permanente o de Sistema)"},{default:l(()=>[o(g,{modelValue:s(a).whatsapp_access_token,"onUpdate:modelValue":e[4]||(e[4]=r=>s(a).whatsapp_access_token=r),type:"password",icon:"i-heroicons-key",placeholder:"Ej: EAAG..."},null,8,["modelValue"])]),_:1})]),o(b),n("div",J,[e[6]||(e[6]=n("p",{class:"font-medium mb-2 text-gray-700 dark:text-gray-300"},"Vista Previa:",-1)),n("div",L,q(s(v)),1)]),n("div",K,[n("div",O,[o(x,{onClick:k,loading:s(_),color:"green",variant:"soft",icon:"i-heroicons-paper-airplane"},{default:l(()=>[...e[7]||(e[7]=[h(" Probar Configuración ",-1)])]),_:1},8,["loading"]),e[8]||(e[8]=n("p",{class:"text-[10px] text-gray-500 max-w-[200px]"},"Se enviará un mensaje de prueba al número que indiques.",-1))]),o(x,{type:"submit",loading:s(u),color:"primary",class:"px-8",icon:"i-heroicons-check"},{default:l(()=>[...e[9]||(e[9]=[h(" Guardar Cambios ",-1)])]),_:1},8,["loading"])])],32)]),_:1})])}}});export{pe as default};
