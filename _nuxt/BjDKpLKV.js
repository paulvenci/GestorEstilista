import{f as q,_ as N}from"./Jb28Xoru.js";import{_ as S}from"./DObld12K.js";import{_ as B,b as T}from"./BH9kdvlr.js";import{_ as $}from"./Cz_GaU6p.js";import{k as G,U as R,a3 as z,a0 as F,l as K,c as b,a as t,b as o,F as L,K as O,w as u,r as m,o as v,D as P,t as g,W,z as A}from"./CGccSeMY.js";import"./BYYinPt_.js";import"./DlAUqK2U.js";import"./CYxRQd5v.js";import"./90Ut9LIE.js";const H={class:"space-y-6"},J={class:"flex justify-between items-center"},Q={class:"grid grid-cols-1 md:grid-cols-3 gap-6"},X={class:"flex items-center justify-between"},Y={class:"flex items-center gap-3"},Z={class:"w-10 h-10 rounded-full bg-emerald-100 dark:bg-emerald-900/30 flex items-center justify-center"},ee={class:"font-bold text-slate-900 dark:text-white"},ae={class:"text-xs text-slate-400"},te={class:"flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity"},se={class:"flex items-center justify-between"},oe={class:"text-base font-semibold text-gray-900 dark:text-white"},ne={class:"flex justify-end gap-3 mt-6"},ve=G({__name:"roles",setup(ie){const r=R(),h=z(),k=F("headerTitle",()=>"Equipo");k.value="Gestión de Roles";const x=m([]),i=m(!1),p=m(!1),c=m(null),l=m(null),d=A({name:""}),y=async()=>{try{let a=h.value?.id;if(!a){const{data:{user:_}}=await r.auth.getUser();a=_?.id}if(!a){console.warn("No user ID found for fetchTenantId");return}const{data:e,error:n}=await r.from("profiles").select("tenant_id").eq("id",a).single();if(n)throw n;e&&(l.value=e.tenant_id,console.log("Tenant ID loaded:",l.value))}catch(a){console.error("Error fetching tenant ID:",a)}},f=async()=>{const{data:a,error:e}=await r.from("specialties").select("*").order("name");if(e){console.error("Error fetching specialties:",e);return}a&&(x.value=a)},E=()=>{c.value=null,d.name="",i.value=!0},C=a=>{c.value=a,d.name=a.name,i.value=!0},I=async()=>{if(d.name){if((!l.value||l.value==="undefined")&&await y(),!l.value||l.value==="undefined"){alert("Error: No se pudo obtener el ID del local válido. Por favor, recarga la página.");return}p.value=!0;try{const a={name:d.name,tenant_id:l.value};if(console.log("Inserting specialty with payload:",a),console.log("Current user ID:",h.value?.id),c.value){const{error:e}=await r.from("specialties").update(a).eq("id",c.value.id);if(e)throw e}else{const{error:e}=await r.from("specialties").insert(a);if(e)throw console.error("Insert error details:",e),e}i.value=!1,await f()}catch(a){alert("Error al guardar: "+a.message)}finally{p.value=!1}}},U=async a=>{if(!confirm(`¿Estás seguro de eliminar "${a.name}"? Esto afectará a los usuarios que la tengan asignada.`))return;const{error:e}=await r.from("specialties").delete().eq("id",a.id);e?alert(e.message):await f()};return K(async()=>{await y(),await f()}),(a,e)=>{const n=q,_=N,w=S,D=T,M=B,V=$;return v(),b("div",H,[t("div",J,[e[4]||(e[4]=t("div",null,[t("h1",{class:"text-3xl font-extrabold text-slate-900 dark:text-white tracking-tight"},"Especialidades"),t("p",{class:"text-slate-500 dark:text-slate-400 mt-1"},"Gestiona los tipos de profesionales (Estilistas, Manicuristas, etc.)")],-1)),o(n,{label:"Nueva Especialidad",icon:"i-heroicons-plus",color:"emerald",onClick:E})]),t("div",Q,[(v(!0),b(L,null,O(x.value,s=>(v(),P(w,{key:s.id,class:"relative group border border-slate-200 dark:border-slate-800 hover:shadow-md transition-all"},{default:u(()=>[t("div",X,[t("div",Y,[t("div",Z,[o(_,{name:"i-heroicons-tag",class:"text-emerald-600 dark:text-emerald-400"})]),t("div",null,[t("h3",ee,g(s.name),1),t("p",ae,"ID: "+g(s.id.slice(0,8)),1)])]),t("div",te,[o(n,{icon:"i-heroicons-pencil-square",color:"gray",variant:"ghost",size:"xs",onClick:j=>C(s)},null,8,["onClick"]),o(n,{icon:"i-heroicons-trash",color:"red",variant:"ghost",size:"xs",onClick:j=>U(s)},null,8,["onClick"])])])]),_:2},1024))),128))]),o(V,{modelValue:i.value,"onUpdate:modelValue":e[3]||(e[3]=s=>i.value=s)},{default:u(()=>[o(w,{ui:{ring:"",divide:"divide-y divide-gray-100 dark:divide-gray-800"}},{header:u(()=>[t("div",se,[t("h3",oe,g(c.value?"Editar Especialidad":"Nueva Especialidad"),1),o(n,{color:"gray",variant:"ghost",icon:"i-heroicons-x-mark-20-solid",class:"-my-1",onClick:e[0]||(e[0]=s=>i.value=!1)})])]),default:u(()=>[t("form",{onSubmit:W(I,["prevent"]),class:"space-y-4 py-2"},[o(M,{label:"Nombre de la Especialidad",help:"Ej: Manicurista, Estilista, Maquillador"},{default:u(()=>[o(D,{modelValue:d.name,"onUpdate:modelValue":e[1]||(e[1]=s=>d.name=s),placeholder:"Ej: Manicurista",autofocus:""},null,8,["modelValue"])]),_:1}),t("div",ne,[o(n,{color:"gray",variant:"ghost",label:"Cancelar",onClick:e[2]||(e[2]=s=>i.value=!1)}),o(n,{type:"submit",color:"emerald",label:c.value?"Guardar Cambios":"Crear Especialidad",loading:p.value},null,8,["label","loading"])])],32)]),_:1})]),_:1},8,["modelValue"])])}}});export{ve as default};
