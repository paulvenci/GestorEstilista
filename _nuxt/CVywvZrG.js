import{f as B,_ as F}from"./BK1iGzOX.js";import{_ as I}from"./Dbnl8vwX.js";import{_ as R}from"./CtQBUKAt.js";import{_ as L}from"./Chr3ArP9.js";import{_ as O,b as K}from"./Bn3KjxKb.js";import{_ as W}from"./Bqn9jvRv.js";import{_ as H}from"./DOPkkKYT.js";import{_ as J}from"./eJSVvdZN.js";import{k as D,U as j,f as Q,D as q,w as s,V as T,e as l,i as w,o as $,b as a,a as o,t as g,W as X,d as N,r as h,a0 as S,l as Y,c as Z,G as ee,E as te}from"./C1tViVxN.js";import"./BWX2_Yhy.js";import"./DlAUqK2U.js";import"./kMxVZpd9.js";import"./DSL453eT.js";import"./CDog84tH.js";import"./F2Urmy6C.js";const oe={class:"flex items-center justify-between"},ae={class:"text-base font-semibold leading-6 text-gray-900 dark:text-white"},le={class:"grid grid-cols-2 gap-4"},se={class:"grid grid-cols-2 gap-4"},ne={class:"ml-2 text-sm text-gray-500"},re={class:"flex justify-end gap-2"},ie=D({__name:"ProductModal",props:{modelValue:{type:Boolean},initialData:{}},emits:["update:modelValue","saved"],setup(E,{emit:y}){const x=E,k=y,p=j(),u=w({get:()=>x.modelValue,set:m=>k("update:modelValue",m)}),t=h({id:void 0,name:"",description:"",price:0,cost:0,stock:0,low_stock_threshold:5,active:!0,tenant_id:void 0}),v=h(!1),V=w(()=>!!t.value.id);Q(()=>x.modelValue,m=>{m&&(x.initialData?t.value={...x.initialData}:t.value={id:void 0,name:"",description:"",price:0,cost:0,stock:0,low_stock_threshold:5,active:!0,tenant_id:void 0})});const U=async()=>{if(t.value.name){v.value=!0;try{const{data:{user:m}}=await p.auth.getUser();if(!m)throw new Error("Usuario no autenticado");const e={...t.value,price:Number(t.value.price),cost:Number(t.value.cost),stock:Number(t.value.stock),low_stock_threshold:Number(t.value.low_stock_threshold)};if(!V.value){const{data:c}=await p.from("profiles").select("tenant_id").eq("id",m.id).single();if(!c)throw new Error("No se encontró perfil para asociar el producto");e.tenant_id=c.tenant_id,delete e.id}let _;if(V.value&&t.value.id){const{error:c}=await p.from("products").update(e).eq("id",t.value.id);_=c}else{const{error:c}=await p.from("products").insert(e);_=c}if(_)throw _;k("saved"),u.value=!1}catch(m){alert(m.message)}finally{v.value=!1}}};return(m,e)=>{const _=B,c=K,f=O,C=W,i=H,n=I,b=J;return $(),q(b,{modelValue:l(u),"onUpdate:modelValue":e[9]||(e[9]=r=>T(u)?u.value=r:null)},{default:s(()=>[a(n,{ui:{ring:"",divide:"divide-y divide-gray-100 dark:divide-gray-800"}},{header:s(()=>[o("div",oe,[o("h3",ae,g(l(V)?"Editar Producto":"Nuevo Producto"),1),a(_,{color:"gray",variant:"ghost",icon:"i-heroicons-x-mark-20-solid",class:"-my-1",onClick:e[0]||(e[0]=r=>u.value=!1)})])]),footer:s(()=>[o("div",re,[a(_,{color:"gray",variant:"ghost",onClick:e[8]||(e[8]=r=>u.value=!1)},{default:s(()=>[...e[10]||(e[10]=[N("Cancelar",-1)])]),_:1}),a(_,{color:"emerald",loading:l(v),onClick:U},{default:s(()=>[...e[11]||(e[11]=[N("Guardar",-1)])]),_:1},8,["loading"])])]),default:s(()=>[o("form",{onSubmit:X(U,["prevent"]),class:"space-y-4"},[a(f,{label:"Nombre del Producto",name:"name",required:""},{default:s(()=>[a(c,{modelValue:l(t).name,"onUpdate:modelValue":e[1]||(e[1]=r=>l(t).name=r),placeholder:"Ej: Shampoo Keratina",autofocus:""},null,8,["modelValue"])]),_:1}),a(f,{label:"Descripción",name:"description"},{default:s(()=>[a(C,{modelValue:l(t).description,"onUpdate:modelValue":e[2]||(e[2]=r=>l(t).description=r),placeholder:"Detalles del producto..."},null,8,["modelValue"])]),_:1}),o("div",le,[a(f,{label:"Precio Venta ($)",name:"price",required:""},{default:s(()=>[a(c,{modelValue:l(t).price,"onUpdate:modelValue":e[3]||(e[3]=r=>l(t).price=r),type:"number",step:"0.01",placeholder:"0.00"},null,8,["modelValue"])]),_:1}),a(f,{label:"Costo ($)",name:"cost"},{default:s(()=>[a(c,{modelValue:l(t).cost,"onUpdate:modelValue":e[4]||(e[4]=r=>l(t).cost=r),type:"number",step:"0.01",placeholder:"0.00"},null,8,["modelValue"])]),_:1})]),o("div",se,[a(f,{label:"Stock Actual",name:"stock",required:""},{default:s(()=>[a(c,{modelValue:l(t).stock,"onUpdate:modelValue":e[5]||(e[5]=r=>l(t).stock=r),type:"number",placeholder:"0"},null,8,["modelValue"])]),_:1}),a(f,{label:"Alerta Stock Bajo",name:"low_stock"},{default:s(()=>[a(c,{modelValue:l(t).low_stock_threshold,"onUpdate:modelValue":e[6]||(e[6]=r=>l(t).low_stock_threshold=r),type:"number",placeholder:"5"},null,8,["modelValue"])]),_:1})]),a(f,{label:"Estado",name:"active"},{default:s(()=>[a(i,{modelValue:l(t).active,"onUpdate:modelValue":e[7]||(e[7]=r=>l(t).active=r)},null,8,["modelValue"]),o("span",ne,g(l(t).active?"Activo":"Inactivo"),1)]),_:1})],32)]),_:1})]),_:1},8,["modelValue"])}}}),de={class:"space-y-6"},ce={class:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4"},ue={class:"grid grid-cols-1 sm:grid-cols-3 gap-4"},me={class:"flex items-center gap-3"},pe={class:"p-2 bg-emerald-100 dark:bg-emerald-900/30 rounded-lg text-emerald-600"},_e={class:"text-2xl font-bold"},ve={class:"flex items-center gap-3"},fe={class:"p-2 bg-red-100 dark:bg-red-900/30 rounded-lg text-red-600"},ge={class:"text-2xl font-bold"},xe={class:"flex items-center gap-3"},ke={class:"p-2 bg-blue-100 dark:bg-blue-900/30 rounded-lg text-blue-600"},be={class:"text-2xl font-bold"},he={class:"font-medium text-slate-900 dark:text-white"},ye={class:"flex gap-2"},Me=D({__name:"index",setup(E){const y=j(),x=S("headerTitle",()=>"Inventario");x.value="Inventario",x.value="Inventario";const k=h(!1),p=h([]),u=h(!1),t=h(null),v=S("userRole"),V=w(()=>{const i=[{key:"name",label:"Producto"},{key:"stock",label:"Stock"},{key:"price",label:"Precio Venta"},{key:"cost",label:"Costo"},{key:"active",label:"Estado"}];return v.value==="admin"&&i.push({key:"actions",label:"Acciones"}),i}),U=w(()=>p.value.filter(i=>i.stock<=(i.low_stock_threshold||5)).length),m=w(()=>p.value.reduce((i,n)=>i+(n.cost||0)*n.stock,0)),e=async()=>{k.value=!0;const{data:{user:i}}=await y.auth.getUser();if(!i){k.value=!1;return}const{data:n,error:b}=await y.from("products").select("*").order("name");n&&(p.value=n),k.value=!1},_=()=>{v.value==="admin"&&(t.value=null,u.value=!0)},c=i=>{v.value==="admin"&&(t.value={...i},u.value=!0)},f=async i=>{if(v.value!=="admin"||!confirm("¿Estás seguro de eliminar este producto?"))return;const{error:n}=await y.from("products").delete().eq("id",i.id);n?alert("Error al eliminar: "+n.message):e()},C=i=>new Intl.NumberFormat("es-CL",{style:"currency",currency:"CLP",minimumFractionDigits:0}).format(i||0);return Y(()=>{e()}),(i,n)=>{const b=B,r=F,P=I,M=R,A=L,z=ie;return $(),Z("div",de,[o("div",ce,[n[1]||(n[1]=o("div",{class:"hidden md:block"},[o("h1",{class:"text-xl md:text-3xl font-extrabold text-slate-900 dark:text-white tracking-tight"},"Inventario de Productos"),o("p",{class:"text-sm md:text-base text-slate-500 dark:text-slate-400"},"Gestiona el stock y precios de tus productos de venta")],-1)),l(v)==="admin"?($(),q(b,{key:0,label:"Nuevo Product",icon:"i-heroicons-plus",color:"emerald",onClick:_,class:"w-full md:w-auto justify-center"})):ee("",!0)]),o("div",ue,[a(P,{ui:{background:"bg-white dark:bg-slate-900"}},{default:s(()=>[o("div",me,[o("div",pe,[a(r,{name:"i-heroicons-cube",class:"text-2xl"})]),o("div",null,[n[2]||(n[2]=o("p",{class:"text-xs text-gray-500 uppercase font-bold"},"Total Productos",-1)),o("p",_e,g(l(p).length),1)])])]),_:1}),a(P,{ui:{background:"bg-white dark:bg-slate-900"}},{default:s(()=>[o("div",ve,[o("div",fe,[a(r,{name:"i-heroicons-exclamation-triangle",class:"text-2xl"})]),o("div",null,[n[3]||(n[3]=o("p",{class:"text-xs text-gray-500 uppercase font-bold"},"Stock Bajo",-1)),o("p",ge,g(l(U)),1)])])]),_:1}),a(P,{ui:{background:"bg-white dark:bg-slate-900"}},{default:s(()=>[o("div",xe,[o("div",ke,[a(r,{name:"i-heroicons-currency-dollar",class:"text-2xl"})]),o("div",null,[n[4]||(n[4]=o("p",{class:"text-xs text-gray-500 uppercase font-bold"},"Valor Inventario",-1)),o("p",be,g(C(l(m))),1)])])]),_:1})]),a(P,{ui:{background:"bg-white dark:bg-slate-900",ring:"ring-1 ring-slate-200 dark:ring-slate-800"}},{default:s(()=>[a(A,{rows:l(p),columns:l(V),loading:l(k),ui:{divide:"divide-y divide-slate-200 dark:divide-slate-800",th:{color:"text-slate-900 dark:text-white"},td:{color:"text-slate-500 dark:text-slate-400"}}},{"price-data":s(({row:d})=>[o("span",he,g(C(d.price)),1)]),"stock-data":s(({row:d})=>[o("span",{class:te({"text-red-500 font-bold":d.stock<=d.low_stock_threshold,"text-emerald-500":d.stock>d.low_stock_threshold})},g(d.stock)+" u. ",3)]),"active-data":s(({row:d})=>[a(M,{color:d.active?"emerald":"gray",variant:"subtle",size:"xs"},{default:s(()=>[N(g(d.active?"Activo":"Inactivo"),1)]),_:2},1032,["color"])]),"actions-data":s(({row:d})=>[o("div",ye,[a(b,{icon:"i-heroicons-pencil-square",size:"xs",color:"blue",variant:"ghost",onClick:G=>c(d)},null,8,["onClick"]),a(b,{icon:"i-heroicons-trash",size:"xs",color:"red",variant:"ghost",onClick:G=>f(d)},null,8,["onClick"])])]),_:1},8,["rows","columns","loading"])]),_:1}),a(z,{modelValue:l(u),"onUpdate:modelValue":n[0]||(n[0]=d=>T(u)?u.value=d:null),"initial-data":l(t),onSaved:e},null,8,["modelValue","initial-data"])])}}});export{Me as default};
