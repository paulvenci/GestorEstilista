import{f as N}from"./BK1iGzOX.js";import{_ as z}from"./CtQBUKAt.js";import{_ as F}from"./Chr3ArP9.js";import{_ as B}from"./Dbnl8vwX.js";import{_ as G,b as P}from"./Bn3KjxKb.js";import{_ as R}from"./DOPkkKYT.js";import{_ as L}from"./eJSVvdZN.js";import{k as D,U as q,f as O,D as M,w as n,V as j,e as a,i as C,o as U,b as o,a as s,t as h,W,d as S,r as b,a0 as E,l as H,c as J,G as K}from"./C1tViVxN.js";import"./BWX2_Yhy.js";import"./DlAUqK2U.js";import"./kMxVZpd9.js";import"./DSL453eT.js";import"./CDog84tH.js";import"./F2Urmy6C.js";const Q={class:"flex items-center justify-between"},X={class:"text-base font-semibold leading-6 text-gray-900 dark:text-white"},Y={class:"grid grid-cols-2 gap-4"},Z={class:"ml-2 text-sm text-gray-500"},ee={class:"flex justify-end gap-2"},te=D({__name:"ServiceModal",props:{modelValue:{type:Boolean},initialData:{}},emits:["update:modelValue","saved"],setup($,{emit:k}){const g=$,_=k,f=q(),r=C({get:()=>g.modelValue,set:u=>_("update:modelValue",u)}),t=b({id:void 0,name:"",price:0,duration_min:30,active:!0}),p=b(!1),V=C(()=>!!t.value.id);O(()=>g.modelValue,u=>{u&&(g.initialData?t.value={...g.initialData}:t.value={id:void 0,name:"",price:0,duration_min:30,active:!0})});const x=async()=>{if(t.value.name){p.value=!0;try{const{data:{user:u}}=await f.auth.getUser();if(!u)throw new Error("Usuario no autenticado");const e={...t.value};if(!V.value){const{data:d}=await f.from("profiles").select("tenant_id").eq("id",u.id).single();if(!d)throw new Error("No se encontró perfil para asociar el servicio");e.tenant_id=d.tenant_id,delete e.id}let v;if(V.value){const{error:d}=await f.from("services").update(e).eq("id",t.value.id);v=d}else{const{error:d}=await f.from("services").insert(e);v=d}if(v)throw v;_("saved"),r.value=!1}catch(u){alert(u.message)}finally{p.value=!1}}};return(u,e)=>{const v=N,d=P,i=G,c=R,y=B,w=L;return U(),M(w,{modelValue:a(r),"onUpdate:modelValue":e[6]||(e[6]=l=>j(r)?r.value=l:null)},{default:n(()=>[o(y,{ui:{ring:"",divide:"divide-y divide-gray-100 dark:divide-gray-800"}},{header:n(()=>[s("div",Q,[s("h3",X,h(a(V)?"Editar Servicio":"Nuevo Servicio"),1),o(v,{color:"gray",variant:"ghost",icon:"i-heroicons-x-mark-20-solid",class:"-my-1",onClick:e[0]||(e[0]=l=>r.value=!1)})])]),footer:n(()=>[s("div",ee,[o(v,{color:"gray",variant:"ghost",onClick:e[5]||(e[5]=l=>r.value=!1)},{default:n(()=>[...e[7]||(e[7]=[S("Cancelar",-1)])]),_:1}),o(v,{color:"emerald",loading:a(p),onClick:x},{default:n(()=>[...e[8]||(e[8]=[S("Guardar",-1)])]),_:1},8,["loading"])])]),default:n(()=>[s("form",{onSubmit:W(x,["prevent"]),class:"space-y-4"},[o(i,{label:"Nombre del Servicio",name:"name",required:""},{default:n(()=>[o(d,{modelValue:a(t).name,"onUpdate:modelValue":e[1]||(e[1]=l=>a(t).name=l),placeholder:"Ej: Corte Caballero",autofocus:""},null,8,["modelValue"])]),_:1}),s("div",Y,[o(i,{label:"Precio ($)",name:"price",required:""},{default:n(()=>[o(d,{modelValue:a(t).price,"onUpdate:modelValue":e[2]||(e[2]=l=>a(t).price=l),type:"number",placeholder:"0.00"},null,8,["modelValue"])]),_:1}),o(i,{label:"Duración (minutos)",name:"duration",required:""},{default:n(()=>[o(d,{modelValue:a(t).duration_min,"onUpdate:modelValue":e[3]||(e[3]=l=>a(t).duration_min=l),type:"number",step:"15",placeholder:"30"},null,8,["modelValue"])]),_:1})]),o(i,{label:"Estado",name:"active"},{default:n(()=>[o(c,{modelValue:a(t).active,"onUpdate:modelValue":e[4]||(e[4]=l=>a(t).active=l)},null,8,["modelValue"]),s("span",Z,h(a(t).active?"Activo":"Inactivo"),1)]),_:1})],32)]),_:1})]),_:1},8,["modelValue"])}}}),ae={class:"space-y-6"},oe={class:"flex justify-between items-center"},ie={class:"font-medium text-slate-900 dark:text-white"},ne={class:"text-slate-500"},le={class:"flex gap-2"},ke=D({__name:"index",setup($){const k=q(),g=E("headerTitle",()=>"Catálogo");g.value="Catálogo";const _=b(!1),f=b([]),r=b(!1),t=b(null),p=E("userRole"),V=C(()=>{const i=[{key:"name",label:"Nombre"},{key:"duration_min",label:"Duración"},{key:"price",label:"Precio"},{key:"active",label:"Estado"}];return p.value==="admin"&&i.push({key:"actions",label:"Acciones"}),i}),x=async()=>{_.value=!0;const{data:{user:i}}=await k.auth.getUser();if(!i){_.value=!1;return}const{data:c,error:y}=await k.from("services").select("*").order("name");c&&(f.value=c),_.value=!1},u=()=>{p.value==="admin"&&(t.value=null,r.value=!0)},e=i=>{p.value==="admin"&&(t.value={...i},r.value=!0)},v=async i=>{if(p.value!=="admin"||!confirm("¿Estás seguro de eliminar este servicio? Si ya tiene citas asociadas, es mejor desactivarlo."))return;const{error:c}=await k.from("services").delete().eq("id",i.id);c?alert("Error al eliminar: "+c.message):x()},d=i=>new Intl.NumberFormat("es-CL",{style:"currency",currency:"CLP",minimumFractionDigits:0}).format(i);return H(()=>{x()}),(i,c)=>{const y=N,w=z,l=F,T=B,A=te;return U(),J("div",ae,[s("div",oe,[c[1]||(c[1]=s("div",{class:"hidden md:block"},[s("h1",{class:"text-xl md:text-3xl font-extrabold text-slate-900 dark:text-white tracking-tight"},"Servicios"),s("p",{class:"text-slate-500 dark:text-slate-400"},"Administra el catálogo de servicios del salón")],-1)),a(p)==="admin"?(U(),M(y,{key:0,label:"Nuevo Servicio",icon:"i-heroicons-plus",color:"emerald",onClick:u})):K("",!0)]),o(T,{ui:{background:"bg-white dark:bg-slate-900",ring:"ring-1 ring-slate-200 dark:ring-slate-800"}},{default:n(()=>[o(l,{rows:a(f),columns:a(V),loading:a(_),ui:{divide:"divide-y divide-slate-200 dark:divide-slate-800",th:{color:"text-slate-900 dark:text-white"},td:{color:"text-slate-500 dark:text-slate-400"}}},{"price-data":n(({row:m})=>[s("span",ie,h(d(m.price)),1)]),"duration_min-data":n(({row:m})=>[s("span",ne,h(m.duration_min)+" min",1)]),"active-data":n(({row:m})=>[o(w,{color:m.active?"emerald":"gray",variant:"subtle",size:"xs"},{default:n(()=>[S(h(m.active?"Activo":"Inactivo"),1)]),_:2},1032,["color"])]),"actions-data":n(({row:m})=>[s("div",le,[o(y,{icon:"i-heroicons-pencil-square",size:"xs",color:"blue",variant:"ghost",onClick:I=>e(m)},null,8,["onClick"]),o(y,{icon:"i-heroicons-trash",size:"xs",color:"red",variant:"ghost",onClick:I=>v(m)},null,8,["onClick"])])]),_:1},8,["rows","columns","loading"])]),_:1}),o(A,{modelValue:a(r),"onUpdate:modelValue":c[0]||(c[0]=m=>j(r)?r.value=m:null),"initial-data":a(t),onSaved:x},null,8,["modelValue","initial-data"])])}}});export{ke as default};
