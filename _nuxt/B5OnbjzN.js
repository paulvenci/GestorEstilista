import{f as $}from"./BK1iGzOX.js";import{_ as z}from"./CtQBUKAt.js";import{_ as j}from"./Chr3ArP9.js";import{_ as G}from"./Dbnl8vwX.js";import{_ as I,b as D}from"./Bn3KjxKb.js";import{_ as O}from"./DoF4r5N4.js";import{_ as R}from"./eJSVvdZN.js";import{k as F,U as L,a0 as W,a3 as H,f as J,l as K,c,a as i,b as t,w as l,r as p,o as _,t as f,d as S,W as Q,G as E,z as X}from"./C1tViVxN.js";import"./BWX2_Yhy.js";import"./DlAUqK2U.js";import"./kMxVZpd9.js";import"./DSL453eT.js";const Y={class:"space-y-6"},Z={class:"flex justify-between items-center"},ee={key:0},oe={key:1,class:"text-xs text-slate-400"},ae={class:"font-medium text-slate-700 dark:text-slate-200"},te={class:"font-medium text-slate-700 dark:text-slate-200"},se={class:"flex items-center justify-between"},le={class:"text-base font-semibold text-gray-900 dark:text-white"},ie={key:0,class:"text-sm text-slate-500 mb-2"},ne={class:"font-bold text-slate-900 dark:text-white"},re={key:1,class:"space-y-4"},de={key:0,class:"text-xs text-slate-500 mt-1"},me={key:2,class:"grid grid-cols-2 gap-4 bg-slate-50 dark:bg-slate-800/50 p-3 rounded-lg border border-slate-100 dark:border-slate-800"},ue={class:"flex justify-end gap-3 mt-6"},Ue=F({__name:"index",setup(ce){const b=L(),q=W("headerTitle",()=>"Equipo");q.value="Equipo";const k=H(),w=p([]),h=p([]),d=p(!1),y=p(!1),n=p(null),m=p(null),e=X({full_name:"",email:"",password:"",role:"stylist",branch_id:"",commission_rate:40,product_commission_rate:10}),M=[{key:"full_name",label:"Nombre"},{key:"role",label:"Rol"},{key:"commission_rate",label:"% Servicios"},{key:"product_commission_rate",label:"% Productos"},{key:"branch_id",label:"Sucursal"},{key:"actions",label:""}],g=async()=>{let s=k.value?.id;if(!s){const{data:{session:o}}=await b.auth.getSession();o?.user&&(s=o.user.id)}if(s){if(!m.value){const{data:o}=await b.from("profiles").select("tenant_id").eq("id",s).single();o&&(m.value=o.tenant_id)}if(m.value){const{data:o,error:r}=await b.from("profiles").select("*").eq("tenant_id",m.value);r&&console.error("Error fetching team:",r),o&&(w.value=o);const{data:x}=await b.from("branches").select("id, name").eq("tenant_id",m.value).eq("active",!0);x&&(h.value=x)}}};J(k,()=>{g()},{immediate:!0});const N=()=>{n.value=null,e.full_name="",e.email="",e.password="",e.role="stylist",e.branch_id="",e.commission_rate=40,e.product_commission_rate=10,d.value=!0},T=s=>{n.value=s,e.full_name=s.full_name,e.role=s.role,e.branch_id=s.branch_id,e.commission_rate=s.commission_rate||0,e.product_commission_rate=s.product_commission_rate||0,d.value=!0},P=async()=>{if(!m.value){alert("Error: No se ha identificado tu negocio.");return}y.value=!0;try{if(n.value){const{error:s}=await b.from("profiles").update({role:e.role,branch_id:e.branch_id,commission_rate:e.commission_rate,product_commission_rate:e.product_commission_rate}).eq("id",n.value.id);if(s)throw s;alert("Miembro actualizado correctamente")}else{const s=await $fetch("/api/admin/users",{method:"POST",body:{email:e.email,password:e.password,full_name:e.full_name,role:e.role,branch_id:e.branch_id||null,tenant_id:m.value,commission_rate:e.commission_rate,product_commission_rate:e.product_commission_rate}});alert("Usuario creado correctamente")}d.value=!1,await g()}catch(s){alert("Error: "+(s.statusMessage||s.message))}finally{y.value=!1}};return K(()=>{g()}),(s,o)=>{const r=$,x=z,A=j,V=G,v=D,u=I,U=O,B=R;return _(),c("div",Y,[i("div",Z,[o[10]||(o[10]=i("div",{class:"hidden md:block"},[i("h1",{class:"text-3xl font-extrabold text-slate-900 dark:text-white tracking-tight"},"Equipo"),i("p",{class:"text-slate-500 dark:text-slate-400 mt-1"},"Administra los usuarios y sus permisos.")],-1)),t(r,{label:"Nuevo Usuario",icon:"i-heroicons-user-plus",color:"emerald",size:"lg",onClick:N,class:"shadow-lg shadow-emerald-500/20"})]),t(V,{ui:{body:{padding:"p-0"}}},{default:l(()=>[t(A,{rows:w.value,columns:M,ui:{thead:"bg-slate-50 dark:bg-slate-800/50",th:{color:"text-slate-900 dark:text-white"},td:{color:"text-slate-600 dark:text-slate-400"}}},{"role-data":l(({row:a})=>[t(x,{color:a.role==="admin"?"purple":"blue",variant:"subtle"},{default:l(()=>[S(f(a.role==="admin"?"Administrador":"Estilista"),1)]),_:2},1032,["color"])]),"branch_id-data":l(({row:a})=>[h.value.length>0?(_(),c("span",ee,f(h.value.find(C=>C.id===a.branch_id)?.name||"Sin Asignar"),1)):(_(),c("span",oe,"Cargando..."))]),"actions-data":l(({row:a})=>[t(r,{icon:"i-heroicons-pencil-square",color:"gray",variant:"ghost",size:"xs",onClick:C=>T(a)},null,8,["onClick"])]),"commission_rate-data":l(({row:a})=>[i("span",ae,f(a.commission_rate)+"%",1)]),"product_commission_rate-data":l(({row:a})=>[i("span",te,f(a.product_commission_rate||0)+"%",1)]),_:1},8,["rows"])]),_:1}),t(B,{modelValue:d.value,"onUpdate:modelValue":o[9]||(o[9]=a=>d.value=a)},{default:l(()=>[t(V,{ui:{ring:"",divide:"divide-y divide-gray-100 dark:divide-gray-800"}},{header:l(()=>[i("div",se,[i("h3",le,f(n.value?"Editar Miembro":"Nuevo Miembro"),1),t(r,{color:"gray",variant:"ghost",icon:"i-heroicons-x-mark-20-solid",class:"-my-1",onClick:o[0]||(o[0]=a=>d.value=!1)})])]),default:l(()=>[i("form",{onSubmit:Q(P,["prevent"]),class:"space-y-4 py-2"},[n.value?(_(),c("div",ie,[o[11]||(o[11]=S(" Editando a: ",-1)),i("span",ne,f(n.value.full_name||"Usuario"),1)])):(_(),c("div",re,[t(u,{label:"Nombre Completo",name:"fullname",required:""},{default:l(()=>[t(v,{modelValue:e.full_name,"onUpdate:modelValue":o[1]||(o[1]=a=>e.full_name=a),icon:"i-heroicons-user"},null,8,["modelValue"])]),_:1}),t(u,{label:"Correo Electrónico",name:"email",required:""},{default:l(()=>[t(v,{modelValue:e.email,"onUpdate:modelValue":o[2]||(o[2]=a=>e.email=a),type:"email",icon:"i-heroicons-envelope"},null,8,["modelValue"])]),_:1}),t(u,{label:"Contraseña",name:"password",required:""},{default:l(()=>[t(v,{modelValue:e.password,"onUpdate:modelValue":o[3]||(o[3]=a=>e.password=a),type:"password",icon:"i-heroicons-lock-closed"},null,8,["modelValue"])]),_:1})])),t(u,{label:"Rol",name:"role"},{default:l(()=>[t(U,{modelValue:e.role,"onUpdate:modelValue":o[4]||(o[4]=a=>e.role=a),options:[{label:"Administrador",value:"admin"},{label:"Estilista",value:"stylist"}]},null,8,["modelValue"]),e.role==="admin"?(_(),c("p",de," Nota: Los administradores tienen acceso completo a la configuración del negocio. ")):E("",!0)]),_:1}),e.role==="stylist"?(_(),c("div",me,[t(u,{label:"% Comisión Servicios",name:"commission_rate",help:"Por defecto para servicios"},{default:l(()=>[t(v,{modelValue:e.commission_rate,"onUpdate:modelValue":o[5]||(o[5]=a=>e.commission_rate=a),type:"number",icon:"i-heroicons-scissors",placeholder:"40"},null,8,["modelValue"])]),_:1}),t(u,{label:"% Comisión Productos",name:"product_commission_rate",help:"Por venta de productos"},{default:l(()=>[t(v,{modelValue:e.product_commission_rate,"onUpdate:modelValue":o[6]||(o[6]=a=>e.product_commission_rate=a),type:"number",icon:"i-heroicons-shopping-bag",placeholder:"10"},null,8,["modelValue"])]),_:1})])):E("",!0),t(u,{label:"Sucursal Asignada",name:"branch"},{default:l(()=>[t(U,{modelValue:e.branch_id,"onUpdate:modelValue":o[7]||(o[7]=a=>e.branch_id=a),options:h.value,"option-attribute":"name","value-attribute":"id",placeholder:"Selecciona una sucursal"},null,8,["modelValue","options"])]),_:1}),i("div",ue,[t(r,{color:"gray",variant:"ghost",label:"Cancelar",onClick:o[8]||(o[8]=a=>d.value=!1)}),t(r,{type:"submit",color:"emerald",label:n.value?"Guardar Cambios":"Crear Usuario",loading:y.value},null,8,["label","loading"])])],32)]),_:1})]),_:1},8,["modelValue"])])}}});export{Ue as default};
