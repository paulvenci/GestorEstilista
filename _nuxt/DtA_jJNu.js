import{f as P,_ as W}from"./fAx4d9s_.js";import{_ as z}from"./PTLvI8bg.js";import{_ as F,b as $}from"./fF1gZkpa.js";import{_ as O,u as m}from"./S7PCAH0u.js";import{_ as R}from"./E0l0qJUK.js";import{_ as J}from"./B3X0yRZn.js";import{k as K,U as Q,l as X,c as U,a as n,b as a,w as s,r as b,o as S,W as E,e as t,t as C,d as k,G as Y,F as Z,K as ee,E as j,i as T}from"./CX5sY2o7.js";import"./CeWU5xK6.js";import"./DlAUqK2U.js";import"./NczMmp7K.js";import"./CdD4j_DF.js";import"./4-hES_iy.js";import"./TOyK0Feh.js";import"./DlJ8G-Bg.js";const ae={class:"p-4 max-w-4xl mx-auto items-start gap-6"},te={class:"font-semibold text-lg flex items-center gap-2"},oe={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},re={class:"bg-gray-50 dark:bg-slate-800 p-4 rounded-lg text-sm"},ne={class:"p-3 bg-white dark:bg-slate-900 border rounded border-gray-200 dark:border-slate-700 italic text-gray-600 dark:text-gray-400"},le={class:"flex justify-between items-center bg-gray-50 dark:bg-slate-800/50 p-4 rounded-xl border border-gray-100 dark:border-slate-700/50"},se={class:"flex items-center gap-2"},ie={class:"font-semibold text-lg flex items-center gap-2"},de={key:0,class:"bg-emerald-50 dark:bg-emerald-900/20 p-4 rounded-lg border border-emerald-200 dark:border-emerald-800"},ce={class:"flex items-center gap-2"},me={class:"text-sm bg-white dark:bg-slate-800 px-3 py-1.5 rounded border border-emerald-200 dark:border-slate-600 flex-1 truncate text-emerald-600 dark:text-emerald-400"},ue={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},pe={class:"grid grid-cols-1 md:grid-cols-3 gap-6"},_e={class:"grid grid-cols-2 sm:grid-cols-4 md:grid-cols-7 gap-3"},ge={class:"flex justify-end"},je=K({__name:"settings",setup(fe){const u=Q(),x=b(!1),v=b(!1),i=b({whatsapp_template:"",enable_reminders:!1,reminder_hours_before:24,whatsapp_phone_number_id:"",whatsapp_access_token:""}),V=b(!1),h=b(""),l=b({booking_enabled:!0,work_start_time:"09:00",work_end_time:"19:00",slot_interval_min:30,work_monday:!0,work_tuesday:!0,work_wednesday:!0,work_thursday:!0,work_friday:!0,work_saturday:!0,work_sunday:!1,confirmation_required:!0,confirmation_message:"Su cita ha sido agendada y está pendiente de confirmación."}),q=[{key:"work_monday",label:"Lun"},{key:"work_tuesday",label:"Mar"},{key:"work_wednesday",label:"Mié"},{key:"work_thursday",label:"Jue"},{key:"work_friday",label:"Vie"},{key:"work_saturday",label:"Sáb"},{key:"work_sunday",label:"Dom"}],A=T(()=>h.value?`${window.location.origin}/book/${h.value}`:""),L=()=>{navigator.clipboard.writeText(A.value),m().add({title:"Link copiado al portapapeles",icon:"i-heroicons-clipboard-document-check",color:"green"})},y={cliente:"Juan Pérez",fecha:new Date().toLocaleDateString("es-ES",{weekday:"long",day:"numeric",month:"long"}),hora:"14:30",estilista:"Ana Gómez"},M=T(()=>{let r=i.value.whatsapp_template||"Hola {cliente}, recordamos tu cita en GestorEstilista el {fecha} a las {hora}.";return r=r.replace(/{cliente}/g,y.cliente),r=r.replace(/{fecha}/g,y.fecha),r=r.replace(/{hora}/g,y.hora),r=r.replace(/{estilista}/g,y.estilista),r}),G=async()=>{try{const{data:{user:r}}=await u.auth.getUser();if(!r)return;const{data:e,error:c}=await u.from("tenants").select("id, slug, settings").single();if(c){console.error("Error fetching settings:",c);return}if(e&&e.settings&&(i.value={...i.value,...e.settings}),h.value=e?.slug||"",e?.id){const{data:_}=await u.from("booking_settings").select("*").eq("tenant_id",e.id).single();_&&(l.value={...l.value,..._})}}catch(r){console.error(r)}},H=async()=>{x.value=!0;try{const{error:r}=await u.rpc("update_tenant_settings",{p_settings:i.value});if(r)throw r;m().add({title:"Configuración guardada",icon:"i-heroicons-check-circle",color:"green"})}catch(r){m().add({title:"Error al guardar",description:r.message,icon:"i-heroicons-x-circle",color:"red"})}finally{x.value=!1}},I=async()=>{if(!i.value.whatsapp_phone_number_id||!i.value.whatsapp_access_token)return m().add({title:"Faltan credenciales",color:"red"});const r=prompt("Ingresa un número de celular para la prueba (con código de país, ej: 56912345678):");if(r){v.value=!0;try{const{data:e,error:c}=await u.functions.invoke("send-reminders",{body:{action:"test",to:r,test_settings:i.value}});if(c)throw c;m().add({title:"Mensaje enviado",description:"Revisa tu WhatsApp",color:"green"})}catch(e){m().add({title:"Error en la prueba",description:e.message,color:"red"})}finally{v.value=!1}}};X(()=>{G()});const B=async()=>{V.value=!0;try{const{data:r}=await u.from("tenants").select("id").single();if(!r)throw new Error("Tenant no encontrado");const{id:e,created_at:c,updated_at:_,tenant_id:d,...g}=l.value,{error:p}=await u.from("booking_settings").upsert({...g,tenant_id:r.id,updated_at:new Date().toISOString()},{onConflict:"tenant_id"});if(p)throw p;m().add({title:"Configuración de agendamiento guardada",icon:"i-heroicons-check-circle",color:"green"})}catch(r){m().add({title:"Error al guardar",description:r.message,icon:"i-heroicons-x-circle",color:"red"})}finally{V.value=!1}};return(r,e)=>{const c=W,_=z,d=F,g=O,p=R,f=$,w=P,D=J;return S(),U("div",ae,[e[19]||(e[19]=n("div",{class:"mb-6"},[n("h1",{class:"text-2xl font-bold text-gray-900 dark:text-white"},"Configuración"),n("p",{class:"text-gray-500 dark:text-gray-400"},"Administra las preferencias de tu negocio.")],-1)),a(D,null,{header:s(()=>[n("h2",te,[a(c,{name:"i-heroicons-chat-bubble-left-right",class:"text-green-500"}),e[11]||(e[11]=k(" Notificaciones WhatsApp ",-1))])]),default:s(()=>[n("form",{onSubmit:E(H,["prevent"]),class:"space-y-6"},[a(d,{label:"Plantilla de Mensaje (Citas)",help:"Variables: {cliente}, {fecha}, {hora}, {estilista}"},{default:s(()=>[a(_,{modelValue:t(i).whatsapp_template,"onUpdate:modelValue":e[0]||(e[0]=o=>t(i).whatsapp_template=o),rows:4,placeholder:"Hola {cliente}, te recordamos tu cita el {fecha} a las {hora} con {estilista}."},null,8,["modelValue"])]),_:1}),a(g),n("div",oe,[a(d,{label:"Habilitar Recordatorios Automáticos",help:"Enviar mensajes automáticamente a los clientes"},{default:s(()=>[a(p,{modelValue:t(i).enable_reminders,"onUpdate:modelValue":e[1]||(e[1]=o=>t(i).enable_reminders=o)},null,8,["modelValue"])]),_:1}),a(d,{label:"Anticipación (Horas)",help:"Cuántas horas antes de la cita enviar el mensaje"},{default:s(()=>[a(f,{modelValue:t(i).reminder_hours_before,"onUpdate:modelValue":e[2]||(e[2]=o=>t(i).reminder_hours_before=o),type:"number",min:"1",max:"72",placeholder:"24",icon:"i-heroicons-clock"},null,8,["modelValue"])]),_:1}),a(d,{label:"WhatsApp Phone Number ID",help:"ID del número de teléfono en Meta for Developers"},{default:s(()=>[a(f,{modelValue:t(i).whatsapp_phone_number_id,"onUpdate:modelValue":e[3]||(e[3]=o=>t(i).whatsapp_phone_number_id=o),icon:"i-heroicons-hashtag",placeholder:"Ej: 100609346..."},null,8,["modelValue"])]),_:1}),a(d,{label:"WhatsApp Access Token",help:"Token de acceso (Permanente o de Sistema)"},{default:s(()=>[a(f,{modelValue:t(i).whatsapp_access_token,"onUpdate:modelValue":e[4]||(e[4]=o=>t(i).whatsapp_access_token=o),type:"password",icon:"i-heroicons-key",placeholder:"Ej: EAAG..."},null,8,["modelValue"])]),_:1})]),a(g),n("div",re,[e[12]||(e[12]=n("p",{class:"font-medium mb-2 text-gray-700 dark:text-gray-300"},"Vista Previa:",-1)),n("div",ne,C(t(M)),1)]),n("div",le,[n("div",se,[a(w,{onClick:I,loading:t(v),color:"green",variant:"soft",icon:"i-heroicons-paper-airplane"},{default:s(()=>[...e[13]||(e[13]=[k(" Probar Configuración ",-1)])]),_:1},8,["loading"]),e[14]||(e[14]=n("p",{class:"text-[10px] text-gray-500 max-w-[200px]"},"Se enviará un mensaje de prueba al número que indiques.",-1))]),a(w,{type:"submit",loading:t(x),color:"primary",class:"px-8",icon:"i-heroicons-check"},{default:s(()=>[...e[15]||(e[15]=[k(" Guardar Cambios ",-1)])]),_:1},8,["loading"])])],32)]),_:1}),a(D,{class:"mt-6"},{header:s(()=>[n("h2",ie,[a(c,{name:"i-heroicons-calendar-days",class:"text-emerald-500"}),e[16]||(e[16]=k(" Agendamiento Online ",-1))])]),default:s(()=>[n("form",{onSubmit:E(B,["prevent"]),class:"space-y-6"},[t(h)?(S(),U("div",de,[e[17]||(e[17]=n("p",{class:"text-sm font-medium text-emerald-700 dark:text-emerald-300 mb-1"},"Link público de agendamiento:",-1)),n("div",ce,[n("code",me,C(t(A)),1),a(w,{icon:"i-heroicons-clipboard",color:"emerald",variant:"soft",size:"xs",onClick:L})])])):Y("",!0),n("div",ue,[a(d,{label:"Activar Agendamiento Online",help:"Los clientes podrán agendar citas desde el link público"},{default:s(()=>[a(p,{modelValue:t(l).booking_enabled,"onUpdate:modelValue":e[5]||(e[5]=o=>t(l).booking_enabled=o)},null,8,["modelValue"])]),_:1}),a(d,{label:"Requerir Confirmación",help:"Las citas quedarán como 'pendientes' hasta que las confirmes"},{default:s(()=>[a(p,{modelValue:t(l).confirmation_required,"onUpdate:modelValue":e[6]||(e[6]=o=>t(l).confirmation_required=o)},null,8,["modelValue"])]),_:1})]),a(g,{label:"Horario de Trabajo"}),n("div",pe,[a(d,{label:"Hora de Apertura"},{default:s(()=>[a(f,{modelValue:t(l).work_start_time,"onUpdate:modelValue":e[7]||(e[7]=o=>t(l).work_start_time=o),type:"time",icon:"i-heroicons-clock"},null,8,["modelValue"])]),_:1}),a(d,{label:"Hora de Cierre"},{default:s(()=>[a(f,{modelValue:t(l).work_end_time,"onUpdate:modelValue":e[8]||(e[8]=o=>t(l).work_end_time=o),type:"time",icon:"i-heroicons-clock"},null,8,["modelValue"])]),_:1}),a(d,{label:"Intervalo (min)",help:"Duración de cada slot de tiempo"},{default:s(()=>[a(f,{modelValue:t(l).slot_interval_min,"onUpdate:modelValue":e[9]||(e[9]=o=>t(l).slot_interval_min=o),type:"number",min:"15",max:"120",step:"15",icon:"i-heroicons-arrows-right-left"},null,8,["modelValue"])]),_:1})]),a(g,{label:"Días Laborales"}),n("div",_e,[(S(),U(Z,null,ee(q,o=>n("div",{key:o.key,class:j(["flex flex-col items-center gap-2 p-3 rounded-lg border",t(l)[o.key]?"border-emerald-500 bg-emerald-50 dark:bg-emerald-900/20":"border-gray-200 dark:border-slate-700"])},[n("span",{class:j(["text-xs font-medium",t(l)[o.key]?"text-emerald-600 dark:text-emerald-400":"text-gray-400"])},C(o.label),3),a(p,{modelValue:t(l)[o.key],"onUpdate:modelValue":N=>t(l)[o.key]=N},null,8,["modelValue","onUpdate:modelValue"])],2)),64))]),a(d,{label:"Mensaje de Confirmación",help:"Se mostrará al cliente al finalizar la reserva"},{default:s(()=>[a(_,{modelValue:t(l).confirmation_message,"onUpdate:modelValue":e[10]||(e[10]=o=>t(l).confirmation_message=o),rows:2,placeholder:"Su cita ha sido agendada y está pendiente de confirmación."},null,8,["modelValue"])]),_:1}),n("div",ge,[a(w,{type:"submit",loading:t(V),color:"emerald",icon:"i-heroicons-check"},{default:s(()=>[...e[18]||(e[18]=[k(" Guardar Configuración de Agendamiento ",-1)])]),_:1},8,["loading"])])],32)]),_:1})])}}});export{je as default};
