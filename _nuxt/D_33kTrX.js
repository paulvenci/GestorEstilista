import{f as q}from"./D8U0mdRn.js";import{b as B,_ as S}from"./WxzpVJyX.js";import{_ as M}from"./DN6h_ypm.js";import{_ as P}from"./BdyN-ehQ.js";import{_ as z}from"./Cs5bkChp.js";import{_ as j}from"./Dd4YpteO.js";import{k as F,U as G,a0 as I,a3 as D,l as O,c as R,a as u,b as t,w as r,V as y,e as n,r as p,o as W,W as A,t as H,i as J}from"./B5RJlC2E.js";import"./QjCVFdca.js";import"./DlAUqK2U.js";import"./D2RKDNJX.js";import"./D3Pdst1a.js";import"./BPjMuzXN.js";import"./D7pqAUps.js";const K={class:"space-y-6"},L={class:"flex justify-between items-center px-4"},Q={class:"p-4 border-b border-slate-100 dark:border-slate-800 bg-slate-50/50 dark:bg-slate-800/50"},X={class:"flex gap-2"},Y={class:"font-bold"},Z={class:"flex justify-end gap-2 mt-4"},fe=F({__name:"index",setup(ee){const m=G(),V=I("headerTitle",()=>"Clientes");V.value="Clientes",D();const d=p(""),b=p(!1),h=p(!1),x=p([]),c=p(!1),l=p({id:void 0,full_name:"",phone:"",email:"",notes:""}),k=J(()=>!!l.value.id),C=[{key:"full_name",label:"Nombre"},{key:"phone",label:"Teléfono"},{key:"email",label:"Email"},{key:"notes",label:"Notas"},{key:"actions",label:""}],_=async()=>{b.value=!0;let o=m.from("clients").select("*").order("created_at",{ascending:!1});d.value&&(o=o.or(`full_name.ilike.%${d.value}%,phone.ilike.%${d.value}%,email.ilike.%${d.value}%`));const{data:e}=await o.limit(50);x.value=e||[],b.value=!1},w=o=>{o?l.value={...o}:l.value={id:void 0,full_name:"",phone:"",email:"",notes:""},c.value=!0},U=async()=>{if(l.value.full_name){h.value=!0;try{const{data:{user:o}}=await m.auth.getUser();if(!o)throw alert("Usuario no autenticado. Por favor, recarga la página."),new Error("User not authenticated");const e={...l.value};delete e.id;let s;if(k.value){const{error:i}=await m.from("clients").update(e).eq("id",l.value.id);s=i}else{const{data:i,error:f}=await m.from("profiles").select("tenant_id").eq("id",o.id).single();if(f)throw console.error("Profile Fetch Error:",f),new Error(`Error al obtener perfil: ${f.message} (User: ${o.id})`);if(!i)throw new Error("No se pudo identificar el salón (tenant) del usuario. Perfil no encontrado.");e.tenant_id=i.tenant_id;const{error:v}=await m.from("clients").insert(e);s=v}if(s)throw s;c.value=!1,await _()}catch(o){o.message!=="User not authenticated"&&alert("Error: "+o.message)}finally{h.value=!1}}},E=async o=>{confirm("¿Estás seguro? Esto podría afectar citas históricas.")&&(await m.from("clients").delete().eq("id",o),_())};return O(()=>{_()}),(o,e)=>{const s=q,i=B,f=M,v=P,g=S,$=z,N=j;return W(),R("div",K,[u("div",L,[e[8]||(e[8]=u("h1",{class:"hidden md:block text-xl md:text-3xl font-extrabold text-slate-900 dark:text-white tracking-tight"},"Clientes",-1)),t(s,{icon:"i-heroicons-plus",label:"Nuevo",color:"emerald",onClick:e[0]||(e[0]=a=>w())})]),t(v,{shadow:"md",ui:{body:{padding:"p-0"},background:"bg-white dark:bg-slate-900",ring:"ring-1 ring-slate-200 dark:ring-slate-800"}},{default:r(()=>[u("div",Q,[t(i,{modelValue:n(d),"onUpdate:modelValue":e[1]||(e[1]=a=>y(d)?d.value=a:null),icon:"i-heroicons-magnifying-glass",placeholder:"Buscar por nombre, teléfono o email...",size:"lg",shadow:"",class:"max-w-md",onInput:_},null,8,["modelValue"])]),t(f,{rows:n(x),columns:C,loading:n(b),ui:{divide:"divide-y divide-slate-200 dark:divide-slate-800",th:{color:"text-slate-900 dark:text-white"},td:{color:"text-slate-500 dark:text-slate-400"}}},{"actions-data":r(({row:a})=>[u("div",X,[t(s,{icon:"i-heroicons-pencil",color:"gray",variant:"ghost",size:"xs",onClick:T=>w(a)},null,8,["onClick"]),t(s,{icon:"i-heroicons-trash",color:"red",variant:"ghost",size:"xs",onClick:T=>E(a.id)},null,8,["onClick"])])]),_:1},8,["rows","loading"])]),_:1}),t(N,{modelValue:n(c),"onUpdate:modelValue":e[7]||(e[7]=a=>y(c)?c.value=a:null)},{default:r(()=>[t(v,null,{header:r(()=>[u("div",Y,H(n(k)?"Editar Cliente":"Nuevo Cliente"),1)]),default:r(()=>[u("form",{onSubmit:A(U,["prevent"]),class:"space-y-4"},[t(g,{label:"Nombre Completo",name:"full_name",required:""},{default:r(()=>[t(i,{modelValue:n(l).full_name,"onUpdate:modelValue":e[2]||(e[2]=a=>n(l).full_name=a)},null,8,["modelValue"])]),_:1}),t(g,{label:"Teléfono",name:"phone"},{default:r(()=>[t(i,{modelValue:n(l).phone,"onUpdate:modelValue":e[3]||(e[3]=a=>n(l).phone=a)},null,8,["modelValue"])]),_:1}),t(g,{label:"Email",name:"email"},{default:r(()=>[t(i,{modelValue:n(l).email,"onUpdate:modelValue":e[4]||(e[4]=a=>n(l).email=a),type:"email"},null,8,["modelValue"])]),_:1}),t(g,{label:"Notas",name:"notes"},{default:r(()=>[t($,{modelValue:n(l).notes,"onUpdate:modelValue":e[5]||(e[5]=a=>n(l).notes=a),placeholder:"Preferencias, alergias, etc."},null,8,["modelValue"])]),_:1}),u("div",Z,[t(s,{color:"gray",variant:"ghost",label:"Cancelar",onClick:e[6]||(e[6]=a=>c.value=!1)}),t(s,{type:"submit",label:"Guardar",loading:n(h)},null,8,["loading"])])],32)]),_:1})]),_:1},8,["modelValue"])])}}});export{fe as default};
