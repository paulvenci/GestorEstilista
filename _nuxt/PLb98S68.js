import{f as B}from"./fAx4d9s_.js";import{_ as I}from"./CMvf5cd1.js";import{_ as R}from"./CU3wAjQm.js";import{_ as D}from"./B3X0yRZn.js";import{_ as z,b as F}from"./fF1gZkpa.js";import{_ as L}from"./DkxcFyOh.js";import{_ as O}from"./E0l0qJUK.js";import{_ as W}from"./B1hDZpdY.js";import{k as j,U as M,f as H,l as P,D as G,w as s,V as T,e as i,i as S,o as $,b as l,a as d,t as x,W as J,d as q,r as f,a0 as N,c as K,G as Q}from"./CX5sY2o7.js";import"./CeWU5xK6.js";import"./DlAUqK2U.js";import"./NczMmp7K.js";import"./CvREtIfb.js";import"./DEqmY_4y.js";import"./4-hES_iy.js";import"./TOyK0Feh.js";import"./DlJ8G-Bg.js";const X={class:"flex items-center justify-between"},Y={class:"text-base font-semibold leading-6 text-gray-900 dark:text-white"},Z={class:"grid grid-cols-2 gap-4"},ee={class:"ml-2 text-sm text-gray-500"},te={class:"flex justify-end gap-2"},ae=j({__name:"ServiceModal",props:{modelValue:{type:Boolean},initialData:{}},emits:["update:modelValue","saved"],setup(E,{emit:y}){const g=E,_=y,m=M(),c=S({get:()=>g.modelValue,set:r=>_("update:modelValue",r)}),a=f({id:void 0,name:"",price:0,duration_min:30,commission_rate:0,specialty_id:"",active:!0}),p=f([]),b=f(!1),v=S(()=>!!a.value.id);H(()=>g.modelValue,r=>{r&&(g.initialData?a.value={...g.initialData}:a.value={id:void 0,name:"",price:0,duration_min:30,commission_rate:0,specialty_id:"",active:!0})});const k=async()=>{if(a.value.name){b.value=!0;try{const{data:{user:r}}=await m.auth.getUser();if(!r)throw new Error("Usuario no autenticado");const e={...a.value};if(!v.value){const{data:n}=await m.from("profiles").select("tenant_id").eq("id",r.id).single();if(!n)throw new Error("No se encontró perfil para asociar el servicio");e.tenant_id=n.tenant_id,delete e.id}e.specialty_id||(e.specialty_id=null);let o;if(v.value){const{error:n}=await m.from("services").update(e).eq("id",a.value.id);o=n}else{const{error:n}=await m.from("services").insert(e);o=n}if(o)throw o;_("saved"),c.value=!1}catch(r){alert(r.message)}finally{b.value=!1}}},V=async()=>{const{data:{user:r}}=await m.auth.getUser();if(!r)return;const{data:e}=await m.from("profiles").select("tenant_id").eq("id",r.id).single();if(!e)return;const{data:o}=await m.from("specialties").select("id, name").eq("tenant_id",e.tenant_id);o&&(p.value=o)};return P(()=>{V()}),(r,e)=>{const o=B,n=F,u=z,h=L,w=O,U=D,C=W;return $(),G(C,{modelValue:i(c),"onUpdate:modelValue":e[8]||(e[8]=t=>T(c)?c.value=t:null)},{default:s(()=>[l(U,{ui:{ring:"",divide:"divide-y divide-gray-100 dark:divide-gray-800"}},{header:s(()=>[d("div",X,[d("h3",Y,x(i(v)?"Editar Servicio":"Nuevo Servicio"),1),l(o,{color:"gray",variant:"ghost",icon:"i-heroicons-x-mark-20-solid",class:"-my-1",onClick:e[0]||(e[0]=t=>c.value=!1)})])]),footer:s(()=>[d("div",te,[l(o,{color:"gray",variant:"ghost",onClick:e[7]||(e[7]=t=>c.value=!1)},{default:s(()=>[...e[9]||(e[9]=[q("Cancelar",-1)])]),_:1}),l(o,{color:"emerald",loading:i(b),onClick:k},{default:s(()=>[...e[10]||(e[10]=[q("Guardar",-1)])]),_:1},8,["loading"])])]),default:s(()=>[d("form",{onSubmit:J(k,["prevent"]),class:"space-y-4"},[l(u,{label:"Nombre del Servicio",name:"name",required:""},{default:s(()=>[l(n,{modelValue:i(a).name,"onUpdate:modelValue":e[1]||(e[1]=t=>i(a).name=t),placeholder:"Ej: Corte Caballero",autofocus:""},null,8,["modelValue"])]),_:1}),d("div",Z,[l(u,{label:"Precio ($)",name:"price",required:""},{default:s(()=>[l(n,{modelValue:i(a).price,"onUpdate:modelValue":e[2]||(e[2]=t=>i(a).price=t),type:"number",placeholder:"0.00"},null,8,["modelValue"])]),_:1}),l(u,{label:"Duración (minutos)",name:"duration",required:""},{default:s(()=>[l(n,{modelValue:i(a).duration_min,"onUpdate:modelValue":e[3]||(e[3]=t=>i(a).duration_min=t),type:"number",step:"15",placeholder:"30"},null,8,["modelValue"])]),_:1})]),l(u,{label:"% Ganancia Peluquería",name:"commission_rate",help:"Porcentaje que gana la peluquería por este servicio"},{default:s(()=>[l(n,{modelValue:i(a).commission_rate,"onUpdate:modelValue":e[4]||(e[4]=t=>i(a).commission_rate=t),type:"number",icon:"i-heroicons-receipt-percent",placeholder:"0"},null,8,["modelValue"])]),_:1}),l(u,{label:"Especialidad / Profesión",name:"specialty_id",help:"Relaciona este servicio con una especialidad para filtrar en el agendamiento online"},{default:s(()=>[l(h,{modelValue:i(a).specialty_id,"onUpdate:modelValue":e[5]||(e[5]=t=>i(a).specialty_id=t),options:[{id:"",name:"Sin especialidad (todas)"},...i(p)],"option-attribute":"name","value-attribute":"id",placeholder:"Selecciona una especialidad"},null,8,["modelValue","options"])]),_:1}),l(u,{label:"Estado",name:"active"},{default:s(()=>[l(w,{modelValue:i(a).active,"onUpdate:modelValue":e[6]||(e[6]=t=>i(a).active=t)},null,8,["modelValue"]),d("span",ee,x(i(a).active?"Activo":"Inactivo"),1)]),_:1})],32)]),_:1})]),_:1},8,["modelValue"])}}}),oe={class:"space-y-6"},ie={class:"flex justify-between items-center"},ne={class:"font-medium text-slate-900 dark:text-white"},le={class:"text-slate-500"},se={class:"font-medium text-slate-700 dark:text-slate-300"},re={class:"flex gap-2"},Ce=j({__name:"index",setup(E){const y=M(),g=N("headerTitle",()=>"Catálogo");g.value="Catálogo";const _=f(!1),m=f([]),c=f(!1),a=f(null),p=N("userRole"),b=S(()=>{const o=[{key:"name",label:"Nombre"},{key:"duration_min",label:"Duración"},{key:"price",label:"Precio"},{key:"commission_rate",label:"% Ganancia"},{key:"active",label:"Estado"}];return p.value==="admin"&&o.push({key:"actions",label:"Acciones"}),o}),v=async()=>{_.value=!0;const{data:{user:o}}=await y.auth.getUser();if(!o){_.value=!1;return}const{data:n,error:u}=await y.from("services").select("*").order("name");n&&(m.value=n),_.value=!1},k=()=>{p.value==="admin"&&(a.value=null,c.value=!0)},V=o=>{p.value==="admin"&&(a.value={...o},c.value=!0)},r=async o=>{if(p.value!=="admin"||!confirm("¿Estás seguro de eliminar este servicio? Si ya tiene citas asociadas, es mejor desactivarlo."))return;const{error:n}=await y.from("services").delete().eq("id",o.id);n?alert("Error al eliminar: "+n.message):v()},e=o=>new Intl.NumberFormat("es-CL",{style:"currency",currency:"CLP",minimumFractionDigits:0}).format(o);return P(()=>{v()}),(o,n)=>{const u=B,h=I,w=R,U=D,C=ae;return $(),K("div",oe,[d("div",ie,[n[1]||(n[1]=d("div",{class:"hidden md:block"},[d("h1",{class:"text-xl md:text-3xl font-extrabold text-slate-900 dark:text-white tracking-tight"},"Servicios"),d("p",{class:"text-slate-500 dark:text-slate-400"},"Administra el catálogo de servicios del salón")],-1)),i(p)==="admin"?($(),G(u,{key:0,label:"Nuevo Servicio",icon:"i-heroicons-plus",color:"emerald",onClick:k})):Q("",!0)]),l(U,{ui:{background:"bg-white dark:bg-slate-900",ring:"ring-1 ring-slate-200 dark:ring-slate-800"}},{default:s(()=>[l(w,{rows:i(m),columns:i(b),loading:i(_),ui:{divide:"divide-y divide-slate-200 dark:divide-slate-800",th:{color:"text-slate-900 dark:text-white"},td:{color:"text-slate-500 dark:text-slate-400"}}},{"price-data":s(({row:t})=>[d("span",ne,x(e(t.price)),1)]),"duration_min-data":s(({row:t})=>[d("span",le,x(t.duration_min)+" min",1)]),"commission_rate-data":s(({row:t})=>[d("span",se,x(t.commission_rate||0)+"%",1)]),"active-data":s(({row:t})=>[l(h,{color:t.active?"emerald":"gray",variant:"subtle",size:"xs"},{default:s(()=>[q(x(t.active?"Activo":"Inactivo"),1)]),_:2},1032,["color"])]),"actions-data":s(({row:t})=>[d("div",re,[l(u,{icon:"i-heroicons-pencil-square",size:"xs",color:"blue",variant:"ghost",onClick:A=>V(t)},null,8,["onClick"]),l(u,{icon:"i-heroicons-trash",size:"xs",color:"red",variant:"ghost",onClick:A=>r(t)},null,8,["onClick"])])]),_:1},8,["rows","columns","loading"])]),_:1}),l(C,{modelValue:i(c),"onUpdate:modelValue":n[0]||(n[0]=t=>T(c)?c.value=t:null),"initial-data":i(a),onSaved:v},null,8,["modelValue","initial-data"])])}}});export{Ce as default};
