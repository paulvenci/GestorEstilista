import{_ as B}from"./B5me2haN.js";import{_ as I}from"./B6BkTIS0.js";import{_ as R}from"./DeqT5uMM.js";import{_ as D}from"./-HABD6Ae.js";import{a as z,_ as F}from"./BBSTtyTp.js";import{_ as L}from"./Di0wXr9H.js";import{_ as O}from"./CMNeP-Ww.js";import{_ as H}from"./CfnJ_uRK.js";import{_ as J}from"./B2xe3f_O.js";import{e as M,f as P,q as K,G as T,m as A,w as l,i as G,h as a,A as $,o as q,b as o,a as c,t as y,j as Q,d as E,r as g,a7 as j,c as W,k as X}from"./BoyDVv4J.js";import"./D6vku3W2.js";import"./DlAUqK2U.js";import"./CzwcVY_m.js";import"./BVhQNc7P.js";import"./B_tjyVtb.js";import"./BZKOFq6c.js";import"./DjvB_zsV.js";import"./CjduMhnr.js";const Y={class:"flex items-center justify-between"},Z={class:"text-base font-semibold leading-6 text-gray-900 dark:text-white"},ee={class:"grid grid-cols-2 gap-4"},te={class:"ml-2 text-sm text-gray-500"},ae={class:"flex justify-end gap-2"},oe=M({__name:"ServiceModal",props:{modelValue:{type:Boolean},initialData:{}},emits:["update:modelValue","saved"],setup(N,{emit:b}){const x=N,v=b,p=P(),u=$({get:()=>x.modelValue,set:d=>v("update:modelValue",d)}),t=g({id:void 0,name:"",description:"",price:0,duration_min:30,commission_rate:0,specialty_id:"",active:!0}),_=g([]),V=g(!1),f=$(()=>!!t.value.id);K(()=>x.modelValue,d=>{d&&(x.initialData?t.value={...x.initialData}:t.value={id:void 0,name:"",description:"",price:0,duration_min:30,commission_rate:0,specialty_id:"",active:!0})});const k=async()=>{if(t.value.name){V.value=!0;try{const{data:{user:d}}=await p.auth.getUser();if(!d)throw new Error("Usuario no autenticado");const e={...t.value};if(!f.value){const{data:n}=await p.from("profiles").select("tenant_id").eq("id",d.id).single();if(!n)throw new Error("No se encontró perfil para asociar el servicio");e.tenant_id=n.tenant_id,delete e.id}e.specialty_id||(e.specialty_id=null);let i;if(f.value){const{error:n}=await p.from("services").update(e).eq("id",t.value.id);i=n}else{const{error:n}=await p.from("services").insert(e);i=n}if(i)throw i;v("saved"),u.value=!1}catch(d){alert(d.message)}finally{V.value=!1}}},h=async()=>{const{data:{user:d}}=await p.auth.getUser();if(!d)return;const{data:e}=await p.from("profiles").select("tenant_id").eq("id",d.id).single();if(!e)return;const{data:i}=await p.from("specialties").select("id, name").eq("tenant_id",e.tenant_id);i&&(_.value=i)};return T(()=>{h()}),(d,e)=>{const i=B,n=F,m=z,w=L,U=O,C=H,S=D,r=J;return q(),A(r,{modelValue:a(u),"onUpdate:modelValue":e[9]||(e[9]=s=>G(u)?u.value=s:null)},{default:l(()=>[o(S,{ui:{ring:"",divide:"divide-y divide-gray-100 dark:divide-gray-800"}},{header:l(()=>[c("div",Y,[c("h3",Z,y(a(f)?"Editar Servicio":"Nuevo Servicio"),1),o(i,{color:"gray",variant:"ghost",icon:"i-heroicons-x-mark-20-solid",class:"-my-1",onClick:e[0]||(e[0]=s=>u.value=!1)})])]),footer:l(()=>[c("div",ae,[o(i,{color:"gray",variant:"ghost",onClick:e[8]||(e[8]=s=>u.value=!1)},{default:l(()=>[...e[10]||(e[10]=[E("Cancelar",-1)])]),_:1}),o(i,{color:"emerald",loading:a(V),onClick:k},{default:l(()=>[...e[11]||(e[11]=[E("Guardar",-1)])]),_:1},8,["loading"])])]),default:l(()=>[c("form",{onSubmit:Q(k,["prevent"]),class:"space-y-4"},[o(m,{label:"Nombre del Servicio",name:"name",required:""},{default:l(()=>[o(n,{modelValue:a(t).name,"onUpdate:modelValue":e[1]||(e[1]=s=>a(t).name=s),placeholder:"Ej: Corte Caballero",autofocus:""},null,8,["modelValue"])]),_:1}),o(m,{label:"Descripción",name:"description",help:"Se muestra en la página de agendamiento para el cliente"},{default:l(()=>[o(w,{modelValue:a(t).description,"onUpdate:modelValue":e[2]||(e[2]=s=>a(t).description=s),placeholder:"Ej: Corte clásico con lavado y secado",rows:2},null,8,["modelValue"])]),_:1}),c("div",ee,[o(m,{label:"Precio ($)",name:"price",required:""},{default:l(()=>[o(n,{modelValue:a(t).price,"onUpdate:modelValue":e[3]||(e[3]=s=>a(t).price=s),type:"number",placeholder:"0.00"},null,8,["modelValue"])]),_:1}),o(m,{label:"Duración (minutos)",name:"duration",required:""},{default:l(()=>[o(n,{modelValue:a(t).duration_min,"onUpdate:modelValue":e[4]||(e[4]=s=>a(t).duration_min=s),type:"number",step:"15",placeholder:"30"},null,8,["modelValue"])]),_:1})]),o(m,{label:"% Ganancia Peluquería",name:"commission_rate",help:"Porcentaje que gana la peluquería por este servicio"},{default:l(()=>[o(n,{modelValue:a(t).commission_rate,"onUpdate:modelValue":e[5]||(e[5]=s=>a(t).commission_rate=s),type:"number",icon:"i-heroicons-receipt-percent",placeholder:"0"},null,8,["modelValue"])]),_:1}),o(m,{label:"Especialidad / Profesión",name:"specialty_id",help:"Relaciona este servicio con una especialidad para filtrar en el agendamiento online"},{default:l(()=>[o(U,{modelValue:a(t).specialty_id,"onUpdate:modelValue":e[6]||(e[6]=s=>a(t).specialty_id=s),options:[{id:"",name:"Sin especialidad (todas)"},...a(_)],"option-attribute":"name","value-attribute":"id",placeholder:"Selecciona una especialidad"},null,8,["modelValue","options"])]),_:1}),o(m,{label:"Estado",name:"active"},{default:l(()=>[o(C,{modelValue:a(t).active,"onUpdate:modelValue":e[7]||(e[7]=s=>a(t).active=s)},null,8,["modelValue"]),c("span",te,y(a(t).active?"Activo":"Inactivo"),1)]),_:1})],32)]),_:1})]),_:1},8,["modelValue"])}}}),ie={class:"space-y-6"},ne={class:"flex justify-between items-center"},le={class:"font-medium text-slate-900 dark:text-white"},se={class:"text-slate-500"},re={class:"font-medium text-slate-700 dark:text-slate-300"},de={class:"flex gap-2"},$e=M({__name:"servicios",setup(N){const b=P(),x=j("headerTitle",()=>"Catálogo");x.value="Catálogo";const v=g(!1),p=g([]),u=g(!1),t=g(null),_=j("userRole"),V=$(()=>{const i=[{key:"name",label:"Nombre"},{key:"duration_min",label:"Duración"},{key:"price",label:"Precio"},{key:"commission_rate",label:"% Ganancia"},{key:"active",label:"Estado"}];return _.value==="admin"&&i.push({key:"actions",label:"Acciones"}),i}),f=async()=>{v.value=!0;const{data:{user:i}}=await b.auth.getUser();if(!i){v.value=!1;return}const{data:n,error:m}=await b.from("services").select("*").order("name");n&&(p.value=n),v.value=!1},k=()=>{_.value==="admin"&&(t.value=null,u.value=!0)},h=i=>{_.value==="admin"&&(t.value={...i},u.value=!0)},d=async i=>{if(_.value!=="admin"||!confirm("¿Estás seguro de eliminar este servicio? Si ya tiene citas asociadas, es mejor desactivarlo."))return;const{error:n}=await b.from("services").delete().eq("id",i.id);n?alert("Error al eliminar: "+n.message):f()},e=i=>new Intl.NumberFormat("es-CL",{style:"currency",currency:"CLP",minimumFractionDigits:0}).format(i);return T(()=>{f()}),(i,n)=>{const m=B,w=I,U=R,C=D,S=oe;return q(),W("div",ie,[c("div",ne,[n[1]||(n[1]=c("div",{class:"hidden md:block"},[c("h1",{class:"text-xl md:text-3xl font-extrabold text-slate-900 dark:text-white tracking-tight"},"Servicios"),c("p",{class:"text-slate-500 dark:text-slate-400"},"Administra el catálogo de servicios del salón")],-1)),a(_)==="admin"?(q(),A(m,{key:0,label:"Nuevo Servicio",icon:"i-heroicons-plus",color:"emerald",onClick:k})):X("",!0)]),o(C,{ui:{background:"bg-white dark:bg-slate-900",ring:"ring-1 ring-slate-200 dark:ring-slate-800"}},{default:l(()=>[o(U,{rows:a(p),columns:a(V),loading:a(v),ui:{divide:"divide-y divide-slate-200 dark:divide-slate-800",th:{color:"text-slate-900 dark:text-white"},td:{color:"text-slate-500 dark:text-slate-400"}}},{"price-data":l(({row:r})=>[c("span",le,y(e(r.price)),1)]),"duration_min-data":l(({row:r})=>[c("span",se,y(r.duration_min)+" min",1)]),"commission_rate-data":l(({row:r})=>[c("span",re,y(r.commission_rate||0)+"%",1)]),"active-data":l(({row:r})=>[o(w,{color:r.active?"emerald":"gray",variant:"subtle",size:"xs"},{default:l(()=>[E(y(r.active?"Activo":"Inactivo"),1)]),_:2},1032,["color"])]),"actions-data":l(({row:r})=>[c("div",de,[o(m,{icon:"i-heroicons-pencil-square",size:"xs",color:"blue",variant:"ghost",onClick:s=>h(r)},null,8,["onClick"]),o(m,{icon:"i-heroicons-trash",size:"xs",color:"red",variant:"ghost",onClick:s=>d(r)},null,8,["onClick"])])]),_:1},8,["rows","columns","loading"])]),_:1}),o(S,{modelValue:a(u),"onUpdate:modelValue":n[0]||(n[0]=r=>G(u)?u.value=r:null),"initial-data":a(t),onSaved:f},null,8,["modelValue","initial-data"])])}}});export{$e as default};
