import{f as N}from"./Jb28Xoru.js";import{_ as A}from"./BIYzKrfT.js";import{_ as I}from"./ixa2wK3h.js";import{_ as q}from"./DObld12K.js";import{_ as z,b as F}from"./BH9kdvlr.js";import{_ as R}from"./vEtdenaM.js";import{_ as L}from"./Cz_GaU6p.js";import{k as B,U as D,f as O,D as j,w as i,V as M,e as a,i as C,o as U,b as o,a as s,t as b,W,d as S,r as k,a0 as E,l as H,c as J,G as K}from"./CGccSeMY.js";import"./BYYinPt_.js";import"./DlAUqK2U.js";import"./CYxRQd5v.js";import"./Lrvz9fIF.js";import"./CUAXYRrS.js";import"./90Ut9LIE.js";import"./ptB9EH2A.js";const Q={class:"flex items-center justify-between"},X={class:"text-base font-semibold leading-6 text-gray-900 dark:text-white"},Y={class:"grid grid-cols-2 gap-4"},Z={class:"ml-2 text-sm text-gray-500"},ee={class:"flex justify-end gap-2"},te=B({__name:"ServiceModal",props:{modelValue:{type:Boolean},initialData:{}},emits:["update:modelValue","saved"],setup($,{emit:V}){const g=$,v=V,f=D(),c=C({get:()=>g.modelValue,set:m=>v("update:modelValue",m)}),t=k({id:void 0,name:"",price:0,duration_min:30,commission_rate:0,active:!0}),_=k(!1),h=C(()=>!!t.value.id);O(()=>g.modelValue,m=>{m&&(g.initialData?t.value={...g.initialData}:t.value={id:void 0,name:"",price:0,duration_min:30,commission_rate:0,active:!0})});const x=async()=>{if(t.value.name){_.value=!0;try{const{data:{user:m}}=await f.auth.getUser();if(!m)throw new Error("Usuario no autenticado");const e={...t.value};if(!h.value){const{data:r}=await f.from("profiles").select("tenant_id").eq("id",m.id).single();if(!r)throw new Error("No se encontró perfil para asociar el servicio");e.tenant_id=r.tenant_id,delete e.id}let p;if(h.value){const{error:r}=await f.from("services").update(e).eq("id",t.value.id);p=r}else{const{error:r}=await f.from("services").insert(e);p=r}if(p)throw p;v("saved"),c.value=!1}catch(m){alert(m.message)}finally{_.value=!1}}};return(m,e)=>{const p=N,r=F,n=z,u=R,y=q,w=L;return U(),j(w,{modelValue:a(c),"onUpdate:modelValue":e[7]||(e[7]=l=>M(c)?c.value=l:null)},{default:i(()=>[o(y,{ui:{ring:"",divide:"divide-y divide-gray-100 dark:divide-gray-800"}},{header:i(()=>[s("div",Q,[s("h3",X,b(a(h)?"Editar Servicio":"Nuevo Servicio"),1),o(p,{color:"gray",variant:"ghost",icon:"i-heroicons-x-mark-20-solid",class:"-my-1",onClick:e[0]||(e[0]=l=>c.value=!1)})])]),footer:i(()=>[s("div",ee,[o(p,{color:"gray",variant:"ghost",onClick:e[6]||(e[6]=l=>c.value=!1)},{default:i(()=>[...e[8]||(e[8]=[S("Cancelar",-1)])]),_:1}),o(p,{color:"emerald",loading:a(_),onClick:x},{default:i(()=>[...e[9]||(e[9]=[S("Guardar",-1)])]),_:1},8,["loading"])])]),default:i(()=>[s("form",{onSubmit:W(x,["prevent"]),class:"space-y-4"},[o(n,{label:"Nombre del Servicio",name:"name",required:""},{default:i(()=>[o(r,{modelValue:a(t).name,"onUpdate:modelValue":e[1]||(e[1]=l=>a(t).name=l),placeholder:"Ej: Corte Caballero",autofocus:""},null,8,["modelValue"])]),_:1}),s("div",Y,[o(n,{label:"Precio ($)",name:"price",required:""},{default:i(()=>[o(r,{modelValue:a(t).price,"onUpdate:modelValue":e[2]||(e[2]=l=>a(t).price=l),type:"number",placeholder:"0.00"},null,8,["modelValue"])]),_:1}),o(n,{label:"Duración (minutos)",name:"duration",required:""},{default:i(()=>[o(r,{modelValue:a(t).duration_min,"onUpdate:modelValue":e[3]||(e[3]=l=>a(t).duration_min=l),type:"number",step:"15",placeholder:"30"},null,8,["modelValue"])]),_:1})]),o(n,{label:"% Ganancia Peluquería",name:"commission_rate",help:"Porcentaje que gana la peluquería por este servicio"},{default:i(()=>[o(r,{modelValue:a(t).commission_rate,"onUpdate:modelValue":e[4]||(e[4]=l=>a(t).commission_rate=l),type:"number",icon:"i-heroicons-receipt-percent",placeholder:"0"},null,8,["modelValue"])]),_:1}),o(n,{label:"Estado",name:"active"},{default:i(()=>[o(u,{modelValue:a(t).active,"onUpdate:modelValue":e[5]||(e[5]=l=>a(t).active=l)},null,8,["modelValue"]),s("span",Z,b(a(t).active?"Activo":"Inactivo"),1)]),_:1})],32)]),_:1})]),_:1},8,["modelValue"])}}}),ae={class:"space-y-6"},oe={class:"flex justify-between items-center"},ie={class:"font-medium text-slate-900 dark:text-white"},ne={class:"text-slate-500"},le={class:"font-medium text-slate-700 dark:text-slate-300"},se={class:"flex gap-2"},he=B({__name:"index",setup($){const V=D(),g=E("headerTitle",()=>"Catálogo");g.value="Catálogo";const v=k(!1),f=k([]),c=k(!1),t=k(null),_=E("userRole"),h=C(()=>{const n=[{key:"name",label:"Nombre"},{key:"duration_min",label:"Duración"},{key:"price",label:"Precio"},{key:"commission_rate",label:"% Ganancia"},{key:"active",label:"Estado"}];return _.value==="admin"&&n.push({key:"actions",label:"Acciones"}),n}),x=async()=>{v.value=!0;const{data:{user:n}}=await V.auth.getUser();if(!n){v.value=!1;return}const{data:u,error:y}=await V.from("services").select("*").order("name");u&&(f.value=u),v.value=!1},m=()=>{_.value==="admin"&&(t.value=null,c.value=!0)},e=n=>{_.value==="admin"&&(t.value={...n},c.value=!0)},p=async n=>{if(_.value!=="admin"||!confirm("¿Estás seguro de eliminar este servicio? Si ya tiene citas asociadas, es mejor desactivarlo."))return;const{error:u}=await V.from("services").delete().eq("id",n.id);u?alert("Error al eliminar: "+u.message):x()},r=n=>new Intl.NumberFormat("es-CL",{style:"currency",currency:"CLP",minimumFractionDigits:0}).format(n);return H(()=>{x()}),(n,u)=>{const y=N,w=A,l=I,G=q,P=te;return U(),J("div",ae,[s("div",oe,[u[1]||(u[1]=s("div",{class:"hidden md:block"},[s("h1",{class:"text-xl md:text-3xl font-extrabold text-slate-900 dark:text-white tracking-tight"},"Servicios"),s("p",{class:"text-slate-500 dark:text-slate-400"},"Administra el catálogo de servicios del salón")],-1)),a(_)==="admin"?(U(),j(y,{key:0,label:"Nuevo Servicio",icon:"i-heroicons-plus",color:"emerald",onClick:m})):K("",!0)]),o(G,{ui:{background:"bg-white dark:bg-slate-900",ring:"ring-1 ring-slate-200 dark:ring-slate-800"}},{default:i(()=>[o(l,{rows:a(f),columns:a(h),loading:a(v),ui:{divide:"divide-y divide-slate-200 dark:divide-slate-800",th:{color:"text-slate-900 dark:text-white"},td:{color:"text-slate-500 dark:text-slate-400"}}},{"price-data":i(({row:d})=>[s("span",ie,b(r(d.price)),1)]),"duration_min-data":i(({row:d})=>[s("span",ne,b(d.duration_min)+" min",1)]),"commission_rate-data":i(({row:d})=>[s("span",le,b(d.commission_rate||0)+"%",1)]),"active-data":i(({row:d})=>[o(w,{color:d.active?"emerald":"gray",variant:"subtle",size:"xs"},{default:i(()=>[S(b(d.active?"Activo":"Inactivo"),1)]),_:2},1032,["color"])]),"actions-data":i(({row:d})=>[s("div",se,[o(y,{icon:"i-heroicons-pencil-square",size:"xs",color:"blue",variant:"ghost",onClick:T=>e(d)},null,8,["onClick"]),o(y,{icon:"i-heroicons-trash",size:"xs",color:"red",variant:"ghost",onClick:T=>p(d)},null,8,["onClick"])])]),_:1},8,["rows","columns","loading"])]),_:1}),o(P,{modelValue:a(c),"onUpdate:modelValue":u[0]||(u[0]=d=>M(c)?c.value=d:null),"initial-data":a(t),onSaved:x},null,8,["modelValue","initial-data"])])}}});export{he as default};
